# B-Tree와 B+ Tree

## 1. 왜 B-Tree가 필요한가?

### 디스크 기반 데이터의 문제
- 디스크는 **페이지(블록) 단위**로 읽음 (4KB, 16KB)
- BST: 노드 하나 읽으려고 페이지 하나를 통째로 읽음 → 낭비
- 트리가 깊어지면 디스크 접근 횟수 증가 → 느림

### B-Tree의 해결책
> "한 번 읽을 때 꽉 채워서 많이 가져오자"

- 노드 하나에 자식을 **50개, 100개** 달기 (Multi-way)
- 트리 높이가 낮아짐
- 디스크 3~4번만 읽어도 1억 개 데이터 접근 가능

---

## 2. (2,4) 트리 (2-3-4 Tree)

### 개념
- 노드가 2, 3, 4개의 자식을 가질 수 있음
- 데이터는 1~3개 저장
- B-Tree의 기초

### 삽입 - Overflow & Split
1. 노드에 데이터가 꽉 차면 (3개)
2. **가운데 값을 부모로 올림**
3. 반으로 쪼갬 (Split)

### 삭제 - Underflow
1. 노드가 비면
2. 형제한테 빌려오기 (Transfer)
3. 또는 형제와 합침 (Fusion)

---

## 3. B-Tree

### 정의
- 모든 리프 노드가 **같은 레벨**에 있는 균형 트리
- 노드는 최소 절반 이상 채워져야 함
- 데이터(Key + Value)가 **모든 노드**에 저장

### 특징
- 균형 유지 → O(log n) 보장
- 디스크 접근 최소화

---

## 4. B+ Tree ⭐⭐⭐

### B-Tree와의 결정적 차이

1. **Index Set**: 내부 노드에는 **키(Key)만** 있음 (길 안내용)
2. **Sequence Set**: **모든 데이터는 리프 노드에만** 존재
3. **Linked List**: 리프 노드끼리 **연결 리스트**로 연결

```
      [30|60]              ← Index Set (키만)
      /   |   \
   [10|20] [40|50] [70|80]  ← Sequence Set (데이터)
     ↔       ↔       ↔      ← Linked List
```

### 왜 B+ Tree인가? - Range Query ⭐⭐⭐

**문제**: "나이가 30~50세인 사람을 찾아라"

**B-Tree의 한계**:
- 30 찾고, 올라가서 31 찾고, 또 내려가고...
- 트리 전체를 뒤집고 다녀야 함

**B+ Tree의 위력**:
1. 30을 찾아서 리프 노드 도달
2. **옆으로 연결된 리스트를 타고 쭉 읽기** (Sequential Access)
3. 50이 나올 때까지만

> **결론**: 정확히 하나 찾는 것은 비슷하지만, **범위 검색(Range Query)** 에서 B+ Tree가 압승!

---

## 5. B+ Tree 삽입 ⭐⭐⭐

### 예제 (노드 용량 3개 가정)

```
1. 10, 20 삽입: 리프 [10, 20]

2. 30 삽입: 리프 [10, 20, 30] (꽉 참)

3. 40 삽입 (Overflow):
   - 리프가 쪼개짐: [10, 20] | [30, 40]
   - 구분자 30이 부모로 올라감
   - ⭐ B+ Tree이므로 리프에도 30이 남음!
   
   결과:
        [30]
       /    \
   [10|20]  [30|40]
```

### 핵심 포인트
- B-Tree: 부모로 올라간 값이 리프에서 **사라짐**
- B+ Tree: 부모로 올라가도 리프에 **복사본(Copy)이 남음**

---

## 6. 시간 복잡도

| 연산 | B-Tree | B+ Tree |
|------|--------|---------|
| 검색 | O(log n) | O(log n) |
| 삽입 | O(log n) | O(log n) |
| 삭제 | O(log n) | O(log n) |
| **범위 검색** | O(log n + k) | **O(log n + k)** 훨씬 효율적 |

(k = 범위 내 데이터 개수)

---

## 7. 실전 활용

### 데이터베이스
- MySQL, PostgreSQL, Oracle 등 대부분의 RDBMS
- 인덱스 구조로 B+ Tree 사용

### 파일 시스템
- NTFS, ext4 등
- 파일 메타데이터 관리

---

## 8. 시험 핵심 체크리스트

- [ ] B-Tree와 B+ Tree의 차이점 3가지
- [ ] B+ Tree에서 Range Query가 효율적인 이유
- [ ] B+ Tree 삽입 시 분할(Split) 과정
- [ ] 리프 노드끼리 Linked List로 연결
- [ ] 부모로 올라간 키가 리프에 남는다 (Copy)
